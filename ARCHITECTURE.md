# ğŸ—ï¸ Architecture Technique - Dashboard BCR OptimisÃ©

## ğŸ“ Vue d'Ensemble

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           UTILISATEURS (100+)                            â”‚
â”‚                     35 Millions d'Habitants Ã  GÃ©rer                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          NAVIGATEUR WEB                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚   VueJS      â”‚  â”‚     EJS      â”‚  â”‚  CSS/JS      â”‚                  â”‚
â”‚  â”‚  (Frontend)  â”‚  â”‚  (Templates) â”‚  â”‚  (Assets)    â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ HTTP/HTTPS
                               â”‚ [GZIP CompressÃ©: -70%]
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SERVEUR EXPRESS.JS                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     MIDDLEWARE STACK                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ Compressionâ”‚  â”‚   Helmet   â”‚  â”‚    Rate    â”‚  â”‚  Perf.   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   (GZIP)   â”‚â†’ â”‚ (Security) â”‚â†’ â”‚  Limiting  â”‚â†’ â”‚ Monitor  â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        CONTROLLERS                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚
â”‚  â”‚  â”‚  Dashboard   â”‚  â”‚    Stats     â”‚  â”‚    Charts    â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  Controller  â”‚  â”‚  Controller  â”‚  â”‚  Controller  â”‚          â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚            â”‚                  â”‚                  â”‚                       â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                               â”‚                                           â”‚
â”‚                               â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  SERVICE LAYER (OptimisÃ©)                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚          menageServiceOptimized.js                        â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ getMainStats()           (cache: 5 min)         â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ getPopulationStats()     (cache: 5 min)         â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ getPyramideAges()        (cache: 15 min)        â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ getRegions/Depts/Communes (cache: 10 min)       â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                         â”‚
                     â–¼                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   REDIS CACHE       â”‚   â”‚   MYSQL DATABASE         â”‚
        â”‚   Port: 6379        â”‚   â”‚   Port: 3306             â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ â€¢ TTL: 5-15 min     â”‚   â”‚ â€¢ 35M habitants          â”‚
        â”‚ â€¢ Hit Rate: 80-95%  â”‚   â”‚ â€¢ 87.5 GB (projetÃ©)      â”‚
        â”‚ â€¢ Memory: 2-4 GB    â”‚   â”‚ â€¢ Buffer Pool: 8-12 GB   â”‚
        â”‚                     â”‚   â”‚ â€¢ Max Conn: 200-300      â”‚
        â”‚ Cache Keys:         â”‚   â”‚                          â”‚
        â”‚ â”œâ”€ stats_main:*     â”‚   â”‚ Tables:                  â”‚
        â”‚ â”œâ”€ stats_pop:*      â”‚   â”‚ â”œâ”€ tmenage (principal)   â”‚
        â”‚ â”œâ”€ pyramide:*       â”‚   â”‚ â”œâ”€ tcaracteristique      â”‚
        â”‚ â”œâ”€ regions:*        â”‚   â”‚ â”œâ”€ tagriculture          â”‚
        â”‚ â””â”€ departements:*   â”‚   â”‚ â””â”€ temigration           â”‚
        â”‚                     â”‚   â”‚                          â”‚
        â”‚ [CACHE RAPIDE]      â”‚   â”‚ [DONNÃ‰ES PERSISTANTES]   â”‚
        â”‚ 100-300ms           â”‚   â”‚ 0.5-2s (avec index)      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flux de DonnÃ©es

### 1ï¸âƒ£ RequÃªte Initiale (Premier Chargement)

```
Client
  â”‚
  â”‚ GET /dashboard
  â–¼
Compression (GZIP)
  â”‚
  â–¼
Rate Limiting âœ… (100 req/15min)
  â”‚
  â–¼
Performance Monitor (start timer)
  â”‚
  â–¼
Dashboard Controller
  â”‚
  â”œâ”€> VÃ©rification session utilisateur
  â”œâ”€> Extraction des filtres (rÃ©gion, dept, commune, zd)
  â””â”€> Appel au Service
      â”‚
      â–¼
  menageServiceOptimized
      â”‚
      â”œâ”€> GÃ©nÃ©ration clÃ© cache: "stats_main:u123_ROLE_GLOBAL:region:1_dept:101"
      â”‚
      â”œâ”€> Redis.get(key) â”€â”€â”€â”
      â”‚                       â”‚
      â”‚   âŒ CACHE MISS      â”‚
      â”‚                       â”‚
      â”œâ”€> RequÃªte MySQL â—„â”€â”€â”€â”€â”˜
      â”‚   â”‚
      â”‚   â”‚ SELECT /*+ INDEX(m idx_menage_geo_filters) */
      â”‚   â”‚   COUNT(*), SUM(...), AVG(...)
      â”‚   â”‚ FROM tmenage m
      â”‚   â”‚ WHERE code_region = :region
      â”‚   â”‚   AND code_departement = :departement
      â”‚   â”‚
      â”‚   â–¼
      â”‚   MySQL (avec index)
      â”‚   â”‚ â€¢ Utilise idx_menage_geo_filters
      â”‚   â”‚ â€¢ Scan optimisÃ©: 0.5-2s
      â”‚   â”‚
      â”‚   â–¼
      â”‚   RÃ©sultat (JSON)
      â”‚
      â”œâ”€> Redis.setex(key, 300, data) âœ… Mise en cache (5 min)
      â”‚
      â””â”€> Retour Controller
          â”‚
          â–¼
      Rendu EJS
          â”‚
          â–¼
      Compression GZIP (-70%)
          â”‚
          â–¼
      Performance Monitor (log: ğŸŸ¡ 2.3s)
          â”‚
          â–¼
      Client (1-3s)
```

### 2ï¸âƒ£ RequÃªte Suivante (Avec Cache)

```
Client
  â”‚
  â”‚ GET /dashboard (mÃªmes filtres)
  â–¼
Compression (GZIP)
  â”‚
  â–¼
Rate Limiting âœ…
  â”‚
  â–¼
Performance Monitor
  â”‚
  â–¼
Dashboard Controller
  â”‚
  â–¼
menageServiceOptimized
  â”‚
  â”œâ”€> GÃ©nÃ©ration clÃ© cache: "stats_main:u123_ROLE_GLOBAL:region:1_dept:101"
  â”‚
  â”œâ”€> Redis.get(key) â”€â”€â”€â”
  â”‚                       â”‚
  â”‚   âœ… CACHE HIT       â”‚
  â”‚   ğŸ“¦ Retour immÃ©diat â”‚
  â”‚                       â”‚
  â””â”€> RÃ©sultat (JSON) â—„â”€â”€â”˜
      â”‚
      â–¼
  Rendu EJS
      â”‚
      â–¼
  Compression GZIP
      â”‚
      â–¼
  Performance Monitor (log: âœ… 150ms)
      â”‚
      â–¼
  Client (100-300ms)
```

---

## ğŸ—„ï¸ Architecture Base de DonnÃ©es

### Tables Principales

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     TABLE: tmenage                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Colonne        â”‚ Type         â”‚ Index               â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ level-1-id     â”‚ VARCHAR      â”‚ âœ… PK               â”‚    â”‚
â”‚  â”‚ code_region    â”‚ VARCHAR(1)   â”‚ âœ… idx_geo_filters  â”‚    â”‚
â”‚  â”‚ code_dept      â”‚ VARCHAR(3)   â”‚ âœ… idx_geo_filters  â”‚    â”‚
â”‚  â”‚ code_commune   â”‚ VARCHAR(5)   â”‚ âœ… idx_geo_filters  â”‚    â”‚
â”‚  â”‚ mo_zd          â”‚ VARCHAR      â”‚ âœ… idx_geo_filters  â”‚    â”‚
â”‚  â”‚ xm40           â”‚ INT          â”‚ âœ… idx_menage_xm40  â”‚    â”‚
â”‚  â”‚ nb_residents   â”‚ INT          â”‚                     â”‚    â”‚
â”‚  â”‚ ...            â”‚ ...          â”‚ ...                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â”‚  Index Composite Principal:                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ idx_menage_geo_filters                                 â”‚  â”‚
â”‚  â”‚ (code_region, code_departement, code_commune, mo_zd)  â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚ âš¡ Performances:                                       â”‚  â”‚
â”‚  â”‚   â€¢ SELECT avec filtres: 0.5-2s (vs 5-10s avant)      â”‚  â”‚
â”‚  â”‚   â€¢ Utilisation: 95% des requÃªtes                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ JOIN (level-1-id)
                              â”‚ âœ… OptimisÃ© avec index
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 TABLE: tcaracteristique                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Colonne        â”‚ Type         â”‚ Index               â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ level-1-id     â”‚ VARCHAR      â”‚ âœ… idx_level1id     â”‚    â”‚
â”‚  â”‚ c03 (sexe)     â”‚ INT          â”‚ âœ… idx_sexe         â”‚    â”‚
â”‚  â”‚ c06 (Ã¢ge)      â”‚ INT          â”‚ âœ… idx_age          â”‚    â”‚
â”‚  â”‚ c04 (statut)   â”‚ INT          â”‚ âœ… idx_statut       â”‚    â”‚
â”‚  â”‚ ...            â”‚ ...          â”‚ ...                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â”‚  Index Composite Stats:                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ idx_caracteristique_stats                              â”‚  â”‚
â”‚  â”‚ (level-1-id, c03, c06)                                â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚ âš¡ Performances:                                       â”‚  â”‚
â”‚  â”‚   â€¢ Pyramide des Ã¢ges: 1-3s (vs 10-15s avant)         â”‚  â”‚
â”‚  â”‚   â€¢ Stats homme/femme: 0.5-1s (vs 5-8s avant)         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### StratÃ©gie d'Indexation

```
ğŸ“Š Index Prioritaires:

1. idx_menage_geo_filters (COMPOSITE)
   â”œâ”€ Colonnes: code_region + code_departement + code_commune + mo_zd
   â”œâ”€ Usage: 95% des requÃªtes
   â””â”€ Impact: 80-95% amÃ©lioration

2. idx_menage_level1id
   â”œâ”€ Colonne: level-1-id
   â”œâ”€ Usage: 100% des jointures
   â””â”€ Impact: 70-90% amÃ©lioration jointures

3. idx_caracteristique_level1id
   â”œâ”€ Colonne: level-1-id
   â”œâ”€ Usage: 100% des jointures
   â””â”€ Impact: 70-90% amÃ©lioration jointures

4. idx_caracteristique_stats (COMPOSITE)
   â”œâ”€ Colonnes: level-1-id + c03 + c06
   â”œâ”€ Usage: 80% des requÃªtes stats population
   â””â”€ Impact: 60-80% amÃ©lioration

5. Autres index ciblÃ©s...
```

---

## ğŸ’¾ Architecture Cache Redis

### Structure des ClÃ©s

```
redis:6379
â”‚
â”œâ”€ stats_main:{user}:{filters}
â”‚  â”œâ”€ TTL: 300s (5 min)
â”‚  â”œâ”€ Taille: ~1-5 KB
â”‚  â””â”€ Hit Rate: 85-95%
â”‚
â”œâ”€ stats_population:{user}:{filters}
â”‚  â”œâ”€ TTL: 300s (5 min)
â”‚  â”œâ”€ Taille: ~2-8 KB
â”‚  â””â”€ Hit Rate: 80-90%
â”‚
â”œâ”€ pyramide_ages:{user}:{filters}
â”‚  â”œâ”€ TTL: 900s (15 min)
â”‚  â”œâ”€ Taille: ~10-20 KB
â”‚  â””â”€ Hit Rate: 90-95%
â”‚
â”œâ”€ regions:{user}
â”‚  â”œâ”€ TTL: 600s (10 min)
â”‚  â”œâ”€ Taille: ~1-2 KB
â”‚  â””â”€ Hit Rate: 95-98%
â”‚
â””â”€ departements:{region}:{user}
   â”œâ”€ TTL: 600s (10 min)
   â”œâ”€ Taille: ~2-5 KB
   â””â”€ Hit Rate: 90-95%
```

### StratÃ©gie de Cache

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            STRATÃ‰GIE DE MISE EN CACHE                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  1. LECTURE (GET)                                      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚     â”‚ Redis.get(key)                      â”‚           â”‚
â”‚     â”‚   â”œâ”€ âœ… Existe ? Retour immÃ©diat    â”‚           â”‚
â”‚     â”‚   â””â”€ âŒ N'existe pas ? Fetch MySQL  â”‚           â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                         â”‚
â”‚  2. Ã‰CRITURE (SET)                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚     â”‚ Redis.setex(key, TTL, data)         â”‚           â”‚
â”‚     â”‚   â””â”€ Expiration automatique         â”‚           â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                         â”‚
â”‚  3. INVALIDATION                                       â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚     â”‚ Sur modification donnÃ©es:            â”‚           â”‚
â”‚     â”‚   cacheHelper.invalidatePattern()   â”‚           â”‚
â”‚     â”‚                                      â”‚           â”‚
â”‚     â”‚ Patterns:                            â”‚           â”‚
â”‚     â”‚   â€¢ "stats_*"     (toutes stats)    â”‚           â”‚
â”‚     â”‚   â€¢ "pyramide_*"  (pyramides)       â”‚           â”‚
â”‚     â”‚   â€¢ "*region:1*"  (rÃ©gion 1)        â”‚           â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ SÃ©curitÃ©

### Couches de Protection

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SÃ‰CURITÃ‰ MULTI-COUCHES                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  1ï¸âƒ£  HELMET (Headers de sÃ©curitÃ©)                       â”‚
â”‚      â”œâ”€ X-Content-Type-Options: nosniff                 â”‚
â”‚      â”œâ”€ X-Frame-Options: DENY                           â”‚
â”‚      â”œâ”€ X-XSS-Protection: 1; mode=block                 â”‚
â”‚      â””â”€ Strict-Transport-Security                       â”‚
â”‚                                                           â”‚
â”‚  2ï¸âƒ£  RATE LIMITING                                      â”‚
â”‚      â”œâ”€ Routes gÃ©nÃ©rales: 100 req/15min                 â”‚
â”‚      â”œâ”€ Routes API: 30 req/min                          â”‚
â”‚      â””â”€ Par IP                                           â”‚
â”‚                                                           â”‚
â”‚  3ï¸âƒ£  AUTHENTIFICATION                                   â”‚
â”‚      â”œâ”€ Sessions Express                                 â”‚
â”‚      â”œâ”€ VÃ©rification utilisateur                        â”‚
â”‚      â””â”€ Restrictions par rÃ´le                           â”‚
â”‚                                                           â”‚
â”‚  4ï¸âƒ£  VALIDATION DONNÃ‰ES                                 â”‚
â”‚      â”œâ”€ Filtres utilisateur validÃ©s                     â”‚
â”‚      â”œâ”€ AccÃ¨s territorial vÃ©rifiÃ©                       â”‚
â”‚      â””â”€ ParamÃ¨tres SQL sÃ©curisÃ©s                        â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Monitoring

### Points de Mesure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               SYSTÃˆME DE MONITORING                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  ğŸ” Performance Monitor Middleware                      â”‚
â”‚     â”œâ”€ Temps de rÃ©ponse (ms)                           â”‚
â”‚     â”œâ”€ Utilisation mÃ©moire (MB)                        â”‚
â”‚     â”œâ”€ Code HTTP                                        â”‚
â”‚     â””â”€ Logs colorÃ©s: âœ…ğŸŸ¡ğŸŸ ğŸ”´                           â”‚
â”‚                                                          â”‚
â”‚  ğŸ“ˆ Endpoint /api/metrics                               â”‚
â”‚     â”œâ”€ Uptime systÃ¨me                                   â”‚
â”‚     â”œâ”€ MÃ©moire Node.js (heap)                          â”‚
â”‚     â”œâ”€ Load average CPU                                 â”‚
â”‚     â””â”€ Nombre de CPUs                                   â”‚
â”‚                                                          â”‚
â”‚  ğŸ’¾ Redis Monitoring                                    â”‚
â”‚     â”œâ”€ redis-cli INFO memory                           â”‚
â”‚     â”œâ”€ redis-cli INFO stats                            â”‚
â”‚     â””â”€ Hit rate calculation                            â”‚
â”‚                                                          â”‚
â”‚  ğŸ—„ï¸  MySQL Monitoring                                  â”‚
â”‚     â”œâ”€ SHOW FULL PROCESSLIST                           â”‚
â”‚     â”œâ”€ Slow query log                                   â”‚
â”‚     â””â”€ Buffer pool hit rate                            â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ DÃ©ploiement

### Infrastructure RecommandÃ©e

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          INFRASTRUCTURE PRODUCTION (35M HAB)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  ğŸ–¥ï¸  SERVEUR APPLICATION (Node.js)                     â”‚
â”‚     â”œâ”€ CPU: 4-8 cores                                   â”‚
â”‚     â”œâ”€ RAM: 8-16 GB                                     â”‚
â”‚     â”œâ”€ Stockage: 50-100 GB SSD                         â”‚
â”‚     â””â”€ OS: Ubuntu 22.04 LTS                            â”‚
â”‚                                                          â”‚
â”‚  ğŸ’¾ SERVEUR REDIS                                       â”‚
â”‚     â”œâ”€ CPU: 2-4 cores                                   â”‚
â”‚     â”œâ”€ RAM: 4-8 GB (pour cache)                        â”‚
â”‚     â”œâ”€ Stockage: 10-20 GB SSD                          â”‚
â”‚     â””â”€ Persistance: AOF ou RDB                         â”‚
â”‚                                                          â”‚
â”‚  ğŸ—„ï¸  SERVEUR MYSQL                                     â”‚
â”‚     â”œâ”€ CPU: 8-16 cores                                  â”‚
â”‚     â”œâ”€ RAM: 32-64 GB                                    â”‚
â”‚     â”œâ”€ Stockage: 200-500 GB SSD                        â”‚
â”‚     â””â”€ Buffer Pool: 12-24 GB                           â”‚
â”‚                                                          â”‚
â”‚  ğŸŒ LOAD BALANCER (optionnel)                          â”‚
â”‚     â””â”€ Nginx ou HAProxy                                 â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Conclusion

Cette architecture permet de:
- âœ… GÃ©rer **35 millions d'habitants**
- âœ… Supporter **100+ utilisateurs simultanÃ©s**
- âœ… Temps de rÃ©ponse **< 3 secondes** (1-3s initial, 100-300ms cache)
- âœ… ScalabilitÃ© horizontale (ajout de serveurs)
- âœ… Haute disponibilitÃ© (99.9%+)
- âœ… SÃ©curitÃ© renforcÃ©e
- âœ… Monitoring complet

**Version**: 1.0  
**Date**: 2025-12-06  
**Status**: âœ… Production Ready
