<!doctype html>
<html lang="en" data-layout="vertical" data-topbar="light" data-sidebar="dark" data-sidebar-size="lg" data-sidebar-image="none" data-preloader="disable" data-theme="default" data-theme-colors="default">

<head>
    <meta charset="utf-8" />
    <title><%= typeof title !== 'undefined' ? title : 'BCR - Tableau de bord RGPH5' %> </title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- App favicon -->
    <link rel="shortcut icon" href="/assets/images/logo-bcr.jpeg">


    <!-- Layout config Js -->
    <script src="/assets/js/layout.js"></script>
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/assets/css/icons.min.css" rel="stylesheet" />
    <link href="/assets/css/app.min.css" rel="stylesheet" />
    <link href="/assets/css/custom.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2-bootstrap-5-theme/1.3.0/select2-bootstrap-5-theme.min.css" rel="stylesheet" />

    



</head>

<body>
    
    <div id="layout-wrapper">
        <%- include('../partials/topbar') %>
        <%- include('../partials/sidebar') %>

        <div class="main-content">
            <div class="page-content">
                <div class="container-fluid">
                    <!-- Contenu spécifique à chaque page -->
                    <%- body %>
                </div>
            </div>

            <%- include('../partials/footer') %>
        </div>
    </div>

    <!-- JS -->
    <script src="/assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/libs/simplebar/simplebar.min.js"></script>
    <script src="/assets/libs/node-waves/waves.min.js"></script>
    <script src="/assets/libs/feather-icons/feather.min.js"></script>
    <script src="/assets/js/pages/plugins/lord-icon-2.1.0.js"></script>
    <script src="/assets/js/plugins.js"></script>
    <script src="/assets/js/app.js"></script>

    <script src="assets/libs/feather-icons/feather.min.js"></script>

     <script src="assets/js/pages/plugins/lord-icon-2.1.0.js"></script>

     <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

     <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>


<script>
$(document).ready(function() {
  $('.select2').select2({
    theme: 'bootstrap-5',
    placeholder: 'Choisir une option',
    allowClear: true,
    width: '100%' // important pour le responsive
  });
});
</script>

<script>
/* ---- mise en surbrillance du menu ---- */
(function highlightMenu(){
    /* 1) on récupère le chemin sans les query-string / hash */
    const path = location.pathname;          // ex:  "/charts"

    /* 2) on parcourt tous les liens du menu */
    document.querySelectorAll('#navbar-nav .nav-link').forEach(link => {
        /* 3) on compare le href du lien avec l’URL courante */
        if (link.getAttribute('href') === path) {
            link.classList.add('active');
        } else {
            link.classList.remove('active');
        }
    });
})();

    const SESSION_TIMEOUT = 3600000; 

    let sessionTimer;

    function startSessionTimer() {
        // Si un timer existe déjà, on le nettoie (pour la session glissante)
        if (sessionTimer) clearTimeout(sessionTimer);

        sessionTimer = setTimeout(() => {       
            // Redirection vers la route de déconnexion pour nettoyer proprement la session
            window.location.href = '/auth/logout'; 
        }, SESSION_TIMEOUT);
    }

    // Relancer le timer à chaque interaction (Session Glissante)
    // Cela permet de ne pas déconnecter l'utilisateur s'il est actif
    ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'].forEach(evt => {
        document.addEventListener(evt, startSessionTimer);
    });

    // Initialisation au chargement de la page
    startSessionTimer();
</script>
</body>
</html>
